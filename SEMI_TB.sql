-- ============================================
-- 0. 기존 테이블 삭제 (자식 → 부모 순)
-- ============================================
DROP TABLE PROJECTMEMBER_TB CASCADE CONSTRAINTS;
DROP TABLE SALARY_TB CASCADE CONSTRAINTS;
DROP TABLE APP_BOARD CASCADE CONSTRAINTS;
DROP TABLE SCHEDULE CASCADE CONSTRAINTS;
DROP TABLE MESSAGE_TB CASCADE CONSTRAINTS;
DROP TABLE VACATION_TB CASCADE CONSTRAINTS;
DROP TABLE PROJECT_TB CASCADE CONSTRAINTS;
DROP TABLE EMPLOYEE_TB CASCADE CONSTRAINTS;
DROP TABLE DEPARTMENT_TB CASCADE CONSTRAINTS;
DROP TABLE JOB_TB CASCADE CONSTRAINTS;

-- ============================================
-- 1. 부모 테이블 생성
-- ============================================
CREATE TABLE DEPARTMENT_TB (
    DEPT_CODE CHAR(2) PRIMARY KEY,
    DEPT_TITLE VARCHAR2(10) NOT NULL
);

CREATE TABLE JOB_TB (
    JOB_CODE CHAR(2) PRIMARY KEY,
    JOB_TITLE VARCHAR2(10) NOT NULL
);

-- ============================================
-- 2. 자식 테이블 생성
-- ============================================
CREATE TABLE EMPLOYEE_TB (
    EMP_NO NUMBER PRIMARY KEY,
    EMP_NAME VARCHAR2(20) NOT NULL,
    EMP_RESINUM VARCHAR2(14) NOT NULL UNIQUE,
    EMP_ID VARCHAR2(20) NOT NULL UNIQUE,
    EMP_PWD VARCHAR2(100) NOT NULL,
    EMP_GENDER CHAR(1) CHECK (EMP_GENDER IN ('M','F')) NOT NULL,
    DEPT_CODE CHAR(2) REFERENCES DEPARTMENT_TB(DEPT_CODE) NOT NULL,
    JOB_CODE CHAR(2) REFERENCES JOB_TB(JOB_CODE) NOT NULL,
    EMP_PHONE VARCHAR2(13) NOT NULL,
    EMP_EMAIL VARCHAR2(50) NOT NULL,
    EMP_STATUS CHAR(1) DEFAULT 'Y' NOT NULL,
    EMP_SIGN VARCHAR2(4000) NOT NULL,
    HIRE_DATE DATE DEFAULT SYSDATE,
    MODIFY_DATE DATE DEFAULT SYSDATE,
    EMP_PICTURE VARCHAR2(4000) NOT NULL
);

CREATE TABLE VACATION_TB (
    VAC_NO NUMBER PRIMARY KEY,
    EMP_NO NUMBER REFERENCES EMPLOYEE_TB(EMP_NO),
    VAC_SDATE DATE,
    VAC_EDATE DATE,
    VAC_STATUS CHAR(1) CHECK(VAC_STATUS IN ('Y','N'))
);

CREATE TABLE PROJECT_TB (
    PJT_NUM NUMBER PRIMARY KEY,
    EMP_NO NUMBER REFERENCES EMPLOYEE_TB(EMP_NO) NOT NULL,
    PJT_NAME VARCHAR2(2000) NOT NULL,
    PJT_ENROLLDATE DATE DEFAULT SYSDATE,
    PJT_COUNT NUMBER DEFAULT 0,
    PJT_STATUS CHAR(20) DEFAULT 'upon' NOT NULL CHECK (PJT_STATUS IN ('afoot','upon','clear')),
    PJT_CONTENT VARCHAR2(4000) NOT NULL
);

CREATE TABLE PROJECTMEMBER_TB (
    PJT_NUM NUMBER NOT NULL REFERENCES PROJECT_TB(PJT_NUM),
    EMP_NO NUMBER NOT NULL REFERENCES EMPLOYEE_TB(EMP_NO),
    PRIMARY KEY (PJT_NUM, EMP_NO)
);

CREATE TABLE SALARY_TB (
    SALARY_ID NUMBER PRIMARY KEY,
    EMP_NO NUMBER REFERENCES EMPLOYEE_TB(EMP_NO) NOT NULL,
    SALARY NUMBER NOT NULL,
    BONUS NUMBER DEFAULT 0
);

CREATE TABLE APP_BOARD (
    APP_NUM NUMBER PRIMARY KEY,
    EMP_NO NUMBER REFERENCES EMPLOYEE_TB(EMP_NO),
    APP_TITLE VARCHAR2(4000) NOT NULL,
    APP_CONTENT VARCHAR2(4000) NOT NULL,
    CREATE_DATE DATE DEFAULT SYSDATE,
    APP_STATUS VARCHAR2(20) DEFAULT 'U' CHECK (APP_STATUS IN ('U','A','D')),
    APP_DATE DATE
);

CREATE TABLE SCHEDULE (
    SCH_NUM NUMBER PRIMARY KEY,
    SCH_NAME VARCHAR2(2000) NOT NULL,
    SCH_CONTENT VARCHAR2(4000) NOT NULL,
    SCH_SDATE DATE NOT NULL,
    SCH_EDATE DATE NOT NULL,
    EMP_NO NUMBER REFERENCES EMPLOYEE_TB(EMP_NO) NOT NULL,
    CREATE_DATE DATE DEFAULT SYSDATE NOT NULL,
    MODIFY_DATE DATE NOT NULL,
    SCH_COUNT NUMBER DEFAULT 0 NOT NULL,
    SCH_STATUS CHAR(30) DEFAULT 'P' NOT NULL CHECK (SCH_STATUS IN ('P','E'))
);

CREATE TABLE MESSAGE_TB (
    MSG_NO NUMBER PRIMARY KEY,
    EMP_NO NUMBER REFERENCES EMPLOYEE_TB(EMP_NO) NOT NULL,
    MSG_TITLE VARCHAR2(1000) DEFAULT '제목없음' NOT NULL,
    MSG_CONTENT VARCHAR2(4000) DEFAULT '내용없음' NOT NULL,
    EMP_NAME VARCHAR2(20) NOT NULL,
    MSG_DATE DATE DEFAULT SYSDATE NOT NULL
);

-- ============================================
-- 3. 트리거 생성
-- ============================================
CREATE OR REPLACE TRIGGER TRG_VAC
BEFORE UPDATE ON VACATION_TB
FOR EACH ROW
BEGIN
    IF :NEW.VAC_SDATE IS NOT NULL THEN
        :NEW.VAC_STATUS := 'Y';
    ELSE
        :NEW.VAC_STATUS := 'N';
    END IF;
END;
/

-- ============================================
-- 4. 시퀀스 생성
-- ============================================
CREATE SEQUENCE SEQ_ENO START WITH 100 NOCYCLE NOCACHE;
CREATE SEQUENCE SEQ_PNO START WITH 1 NOCYCLE NOCACHE;
CREATE SEQUENCE SEQ_VNO START WITH 1 NOCYCLE NOCACHE;
CREATE SEQUENCE SEQ_SNO START WITH 1 NOCYCLE NOCACHE;
CREATE SEQUENCE SEQ_ANO START WITH 1 NOCYCLE NOCACHE;
CREATE SEQUENCE SEQ_MNO START WITH 1 NOCYCLE NOCACHE;
CREATE SEQUENCE SEQ_SALARY START WITH 1 NOCYCLE NOCACHE;

-- ============================================
-- 5. DEPARTMENT_TB 샘플 데이터
-- ============================================
INSERT INTO DEPARTMENT_TB VALUES('D1','인사');
INSERT INTO DEPARTMENT_TB VALUES('D2','영업');
INSERT INTO DEPARTMENT_TB VALUES('D3','개발');
INSERT INTO DEPARTMENT_TB VALUES('D4','기획');
INSERT INTO DEPARTMENT_TB VALUES('D5','마케팅');

-- ============================================
-- 6. JOB_TB 샘플 데이터
-- ============================================
INSERT INTO JOB_TB VALUES('J1','사원');
INSERT INTO JOB_TB VALUES('J2','주임');
INSERT INTO JOB_TB VALUES('J3','대리');
INSERT INTO JOB_TB VALUES('J4','과장');
INSERT INTO JOB_TB VALUES('J5','부장');

-- ============================================
-- 7. EMPLOYEE_TB 샘플 데이터
-- ============================================
INSERT INTO EMPLOYEE_TB (EMP_NO, EMP_NAME, EMP_RESINUM, EMP_ID, EMP_PWD, EMP_GENDER,
    DEPT_CODE, JOB_CODE, EMP_PHONE, EMP_EMAIL, EMP_SIGN, EMP_PICTURE)
VALUES (SEQ_ENO.NEXTVAL,'홍길동','900101-1234567','hong','pass123','M','D1','J1','010-1234-5678','hong@company.com','홍길동서명','/images/hong.jpg');

INSERT INTO EMPLOYEE_TB (EMP_NO, EMP_NAME, EMP_RESINUM, EMP_ID, EMP_PWD, EMP_GENDER,
    DEPT_CODE, JOB_CODE, EMP_PHONE, EMP_EMAIL, EMP_SIGN, EMP_PICTURE)
VALUES (SEQ_ENO.NEXTVAL,'김철수','900102-2345678','kim','pass123','M','D2','J2','010-2345-6789','kim@company.com','김철수서명','/images/kim.jpg');

INSERT INTO EMPLOYEE_TB (EMP_NO, EMP_NAME, EMP_RESINUM, EMP_ID, EMP_PWD, EMP_GENDER,
    DEPT_CODE, JOB_CODE, EMP_PHONE, EMP_EMAIL, EMP_SIGN, EMP_PICTURE)
VALUES (SEQ_ENO.NEXTVAL,'이영희','900103-3456789','lee','pass123','F','D3','J3','010-3456-7890','lee@company.com','이영희서명','/images/lee.jpg');

INSERT INTO EMPLOYEE_TB (EMP_NO, EMP_NAME, EMP_RESINUM, EMP_ID, EMP_PWD, EMP_GENDER,
    DEPT_CODE, JOB_CODE, EMP_PHONE, EMP_EMAIL, EMP_SIGN, EMP_PICTURE)
VALUES (SEQ_ENO.NEXTVAL,'박민수','900104-4567890','park','pass123','M','D4','J4','010-4567-8901','park@company.com','박민수서명','/images/park.jpg');

INSERT INTO EMPLOYEE_TB (EMP_NO, EMP_NAME, EMP_RESINUM, EMP_ID, EMP_PWD, EMP_GENDER,
    DEPT_CODE, JOB_CODE, EMP_PHONE, EMP_EMAIL, EMP_SIGN, EMP_PICTURE)
VALUES (SEQ_ENO.NEXTVAL,'최지은','900105-5678901','choi','pass123','F','D5','J5','010-5678-9012','choi@company.com','최지은서명','/images/choi.jpg');

-- ============================================
-- 8. VACATION_TB 샘플 데이터
-- ============================================
INSERT INTO VACATION_TB (VAC_NO, EMP_NO, VAC_SDATE, VAC_EDATE)
SELECT SEQ_VNO.NEXTVAL, EMP_NO, DATE '2025-08-01', DATE '2025-08-05' FROM EMPLOYEE_TB WHERE EMP_NO BETWEEN 100 AND 104;

-- ============================================
-- 9. PROJECT_TB 샘플 데이터
-- ============================================
INSERT INTO PROJECT_TB (PJT_NUM, EMP_NO, PJT_NAME, PJT_ENROLLDATE, PJT_COUNT, PJT_STATUS, PJT_CONTENT)
VALUES (SEQ_PNO.NEXTVAL, 100, 'ERP 구축', DATE '2025-08-01', 0, 'upon', 'ERP 시스템 구축 프로젝트');

INSERT INTO PROJECT_TB (PJT_NUM, EMP_NO, PJT_NAME, PJT_ENROLLDATE, PJT_COUNT, PJT_STATUS, PJT_CONTENT)
VALUES (SEQ_PNO.NEXTVAL, 101, 'CRM 도입', DATE '2025-08-02', 0, 'upon', 'CRM 시스템 도입 프로젝트');

INSERT INTO PROJECT_TB (PJT_NUM, EMP_NO, PJT_NAME, PJT_ENROLLDATE, PJT_COUNT, PJT_STATUS, PJT_CONTENT)
VALUES (SEQ_PNO.NEXTVAL, 102, '웹사이트 개선', DATE '2025-08-03', 0, 'upon', '기업 웹사이트 개선 프로젝트');

INSERT INTO PROJECT_TB (PJT_NUM, EMP_NO, PJT_NAME, PJT_ENROLLDATE, PJT_COUNT, PJT_STATUS, PJT_CONTENT)
VALUES (SEQ_PNO.NEXTVAL, 103, '모바일 앱 개발', DATE '2025-08-04', 0, 'upon', '모바일 앱 개발 프로젝트');

INSERT INTO PROJECT_TB (PJT_NUM, EMP_NO, PJT_NAME, PJT_ENROLLDATE, PJT_COUNT, PJT_STATUS, PJT_CONTENT)
VALUES (SEQ_PNO.NEXTVAL, 104, '인프라 확충', DATE '2025-08-05', 0, 'upon', '서버 및 네트워크 인프라 확충 프로젝트');

-- ============================================
-- 10. PROJECTMEMBER_TB 샘플 데이터
-- ============================================
INSERT INTO PROJECTMEMBER_TB (PJT_NUM, EMP_NO) VALUES (1,100);
INSERT INTO PROJECTMEMBER_TB (PJT_NUM, EMP_NO) VALUES (1,101);
INSERT INTO PROJECTMEMBER_TB (PJT_NUM, EMP_NO) VALUES (2,102);
INSERT INTO PROJECTMEMBER_TB (PJT_NUM, EMP_NO) VALUES (3,103);
INSERT INTO PROJECTMEMBER_TB (PJT_NUM, EMP_NO) VALUES (4,104);

-- ============================================
-- 11. SALARY_TB 샘플 데이터
-- ============================================
INSERT INTO SALARY_TB (SALARY_ID, EMP_NO, SALARY, BONUS)
VALUES (SEQ_SALARY.NEXTVAL, 100, 3000, 200);
INSERT INTO SALARY_TB (SALARY_ID, EMP_NO, SALARY, BONUS)
VALUES (SEQ_SALARY.NEXTVAL, 101, 3200, 250);
INSERT INTO SALARY_TB (SALARY_ID, EMP_NO, SALARY, BONUS)
VALUES (SEQ_SALARY.NEXTVAL, 102, 3500, 300);
INSERT INTO SALARY_TB (SALARY_ID, EMP_NO, SALARY, BONUS)
VALUES (SEQ_SALARY.NEXTVAL, 103, 4000, 500);
INSERT INTO SALARY_TB (SALARY_ID, EMP_NO, SALARY, BONUS)
VALUES (SEQ_SALARY.NEXTVAL, 104, 3800, 400);

-- ============================================
-- 12. APP_BOARD 샘플 데이터
-- ============================================
INSERT INTO APP_BOARD (APP_NUM, EMP_NO, APP_TITLE, APP_CONTENT, CREATE_DATE, APP_STATUS, APP_DATE)
VALUES (SEQ_ANO.NEXTVAL,100,'출장 보고','서울 출장 보고 내용',SYSDATE,'U',NULL);

INSERT INTO APP_BOARD (APP_NUM, EMP_NO, APP_TITLE, APP_CONTENT, CREATE_DATE, APP_STATUS, APP_DATE)
VALUES (SEQ_ANO.NEXTVAL,101,'회의 안건','회의 안건 내용',SYSDATE,'U',NULL);

INSERT INTO APP_BOARD (APP_NUM, EMP_NO, APP_TITLE, APP_CONTENT, CREATE_DATE, APP_STATUS, APP_DATE)
VALUES (SEQ_ANO.NEXTVAL,102,'프로젝트 승인','프로젝트 승인 내용',SYSDATE,'U',NULL);

INSERT INTO APP_BOARD (APP_NUM, EMP_NO, APP_TITLE, APP_CONTENT, CREATE_DATE, APP_STATUS, APP_DATE)
VALUES (SEQ_ANO.NEXTVAL,103,'휴가 요청','휴가 요청 내용',SYSDATE,'U',NULL);

INSERT INTO APP_BOARD (APP_NUM, EMP_NO, APP_TITLE, APP_CONTENT, CREATE_DATE, APP_STATUS, APP_DATE)
VALUES (SEQ_ANO.NEXTVAL,104,'예산 승인','예산 승인 내용',SYSDATE,'U',NULL);

-- ============================================
-- 13. SCHEDULE 샘플 데이터
-- ============================================
INSERT INTO SCHEDULE (SCH_NUM, SCH_NAME, SCH_CONTENT, SCH_SDATE, SCH_EDATE, EMP_NO, CREATE_DATE, MODIFY_DATE, SCH_COUNT, SCH_STATUS)
VALUES (SEQ_SNO.NEXTVAL,'회의 A','주간 회의',DATE '2025-08-01',DATE '2025-08-01',100,SYSDATE,SYSDATE,0,'P');

INSERT INTO SCHEDULE (SCH_NUM, SCH_NAME, SCH_CONTENT, SCH_SDATE, SCH_EDATE, EMP_NO, CREATE_DATE, MODIFY_DATE, SCH_COUNT, SCH_STATUS)
VALUES (SEQ_SNO.NEXTVAL,'보고서 제출','월간 보고서 제출',DATE '2025-08-05',DATE '2025-08-05',101,SYSDATE,SYSDATE,0,'P');

INSERT INTO SCHEDULE (SCH_NUM, SCH_NAME, SCH_CONTENT, SCH_SDATE, SCH_EDATE, EMP_NO, CREATE_DATE, MODIFY_DATE, SCH_COUNT, SCH_STATUS)
VALUES (SEQ_SNO.NEXTVAL,'교육','신입 교육',DATE '2025-08-10',DATE '2025-08-12',102,SYSDATE,SYSDATE,0,'P');

INSERT INTO SCHEDULE (SCH_NUM, SCH_NAME, SCH_CONTENT, SCH_SDATE, SCH_EDATE, EMP_NO, CREATE_DATE, MODIFY_DATE, SCH_COUNT, SCH_STATUS)
VALUES (SEQ_SNO.NEXTVAL,'워크샵','팀워크 강화',DATE '2025-08-15',DATE '2025-08-16',103,SYSDATE,SYSDATE,0,'P');

INSERT INTO SCHEDULE (SCH_NUM, SCH_NAME, SCH_CONTENT, SCH_SDATE, SCH_EDATE, EMP_NO, CREATE_DATE, MODIFY_DATE, SCH_COUNT, SCH_STATUS)
VALUES (SEQ_SNO.NEXTVAL,'회의 B','프로젝트 회의',DATE '2025-08-20',DATE '2025-08-20',104,SYSDATE,SYSDATE,0,'P');

-- ============================================
-- 14. MESSAGE_TB 샘플 데이터
-- ============================================
INSERT INTO MESSAGE_TB (MSG_NO, EMP_NO, MSG_TITLE, MSG_CONTENT, EMP_NAME, MSG_DATE)
VALUES (SEQ_MNO.NEXTVAL,100,'공지 A','공지사항 내용 A','홍길동',SYSDATE);

INSERT INTO MESSAGE_TB (MSG_NO, EMP_NO, MSG_TITLE, MSG_CONTENT, EMP_NAME, MSG_DATE)
VALUES (SEQ_MNO.NEXTVAL,101,'공지 B','공지사항 내용 B','김철수',SYSDATE);

INSERT INTO MESSAGE_TB (MSG_NO, EMP_NO, MSG_TITLE, MSG_CONTENT, EMP_NAME, MSG_DATE)
VALUES (SEQ_MNO.NEXTVAL,102,'공지 C','공지사항 내용 C','이영희',SYSDATE);

INSERT INTO MESSAGE_TB (MSG_NO, EMP_NO, MSG_TITLE, MSG_CONTENT, EMP_NAME, MSG_DATE)
VALUES (SEQ_MNO.NEXTVAL,103,'공지 D','공지사항 내용 D','박민수',SYSDATE);

INSERT INTO MESSAGE_TB (MSG_NO, EMP_NO, MSG_TITLE, MSG_CONTENT, EMP_NAME, MSG_DATE)
VALUES (SEQ_MNO.NEXTVAL,104,'공지 E','공지사항 내용 E','최지은',SYSDATE);
