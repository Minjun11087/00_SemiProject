<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <title>사내일정 승인관리</title>
    <style>
        /* 스타일 코드는 동일하게 유지 */
        .main-container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
        .breadcrumb { background: #f7fafc; color: #718096; font-size: 14px; margin-bottom: 20px; padding: 0.75rem 1rem; border-radius: 8px; }
        .breadcrumb a { color: #e4b6ec; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .page-header { background: white; border-radius: 20px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .page-title { font-size: 2rem; font-weight: bold; color: #1f2937; margin-bottom: 0.5rem; }
        .page-subtitle { color: #6b7280; font-size: 1.1rem; }
        .request-list { background: white; border-radius: 20px; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #e4b6ec; }
        .list-title { font-size: 1.5rem; font-weight: bold; color: #1f2937; }
        .filter-tabs { display: flex; gap: 0.5rem; background: #f3f4f6; padding: 0.25rem; border-radius: 10px; }
        .filter-tab { padding: 0.5rem 1rem; border: none; background: transparent; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-size: 0.875rem; }
        .filter-tab.active { background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); color: #e4b6ec; font-weight: 600; }
        .request-card { background: #fafafa; border: 2px solid #e5e7eb; border-radius: 15px; padding: 1.5rem; margin-bottom: 1.5rem; transition: all 0.3s ease; position: relative; }
        .request-card:hover { border-color: #e4b6ec; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .request-card.pending { border-left: 5px solid #3B82F6; }
        .request-card.approved { border-left: 5px solid #10b981; }
        .request-card.rejected { border-left: 5px solid #ef4444; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .request-title { font-size: 1.25rem; font-weight: bold; color: #1f2937; margin-bottom: 0.5rem; }
        .request-meta { display: flex; gap: 1rem; font-size: 0.875rem; color: #6b7280; }
        .status-badge { padding: 0.375rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .status-pending { background: #3B82F6; color: white; }
        .status-approved { background: #d1fae5; color: #059669; }
        .status-rejected { background: #fee2e2; color: #dc2626; }
        .card-content { margin: 1rem 0; }
        .content-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem; }
        .content-item { display: flex; flex-direction: column; gap: 0.25rem; }
        .content-label { font-size: 0.875rem; font-weight: 600; color: #374151; }
        .content-value { font-size: 0.95rem; color: #1f2937; }
        .card-actions { display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 0.875rem; display: flex; align-items: center; gap: 0.5rem; }
        .btn-approve { background: #10b981; color: white; }
        .btn-approve:hover { background: #059669; transform: translateY(-2px); }
        .btn-reject { background: #ef4444; color: white; }
        .btn-reject:hover { background: #dc2626; transform: translateY(-2px); }
        .btn-view { background: #6366f1; color: white; }
        .btn-view:hover { background: #4f46e5; transform: translateY(-2px); }
        .btn-secondary { background: #f3f4f6; color: #6b7280; }
        .btn-secondary:hover { background: #e5e7eb; }
        .empty-state { text-align: center; padding: 3rem; color: #6b7280; }
        .empty-state h3 { font-size: 1.25rem; margin-bottom: 0.5rem; }
        @media (max-width: 768px) {
            .main-container { padding: 0 1rem; }
            .content-row { grid-template-columns: 1fr; gap: 1rem; }
            .card-actions { flex-direction: column; }
            .filter-tabs { overflow-x: auto; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .request-card { animation: fadeIn 0.6s ease forwards; }
    </style>
</head>
<body>
<main class="main-container">
    <div class="breadcrumb">
        <a href="#">프로젝트 관리</a> > <span>일정 승인</span>
    </div>
    <div class="page-header">
        <h1 class="page-title">사내일정 승인관리</h1>
        <p class="page-subtitle">사내 일정을 검토하고 승인/반려 처리하세요(인사과)</p>
    </div>
    <div class="request-list">
        <div class="list-header">
            <h2 class="list-title">일정 신청 목록</h2>
            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterRequests('all')">전체</button>
                <button class="filter-tab" onclick="filterRequests('pending')">검토</button>
                <button class="filter-tab" onclick="filterRequests('approved')">승인</button>
                <button class="filter-tab" onclick="filterRequests('rejected')">반려</button>
            </div>
        </div>
        <div id="requestList">
            <!-- 신청 항목들이 여기에 동적으로 생성됩니다 -->
        </div>
    </div>
</main>
<form id="actionForm" method="POST">
    <!-- 폼 필드 추가, 예: schNo, actionReason 등 -->
    <input type="hidden" id="schNo" name="schNo">
</form>
<script th:inline="javascript">
    const confirmSchedules = /*[[${clist}]]*/ [];
    const confirmSchedulesObj = {};
    confirmSchedules.forEach(request => {
        confirmSchedulesObj[`request${request.schNo}`] = request;
    });
    let currentFilter = 'all';
    let selectedRequest = null;
    // 일정 목록 렌더링
    function renderRequests() {
        const container = document.getElementById('requestList');
        const filteredRequests = confirmSchedules.filter(req =>
            currentFilter === 'all' ||
            (currentFilter === 'pending' && req.schStatus === 'c') ||
            (currentFilter === 'approved' && req.schStatus === 'p') ||
            (currentFilter === 'rejected' && req.schStatus === 'n')
        );
        if (filteredRequests.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>해당하는 일정이 없습니다</h3>
                </div>
            `;
            return;
        }
        container.innerHTML = filteredRequests.map(req => `
            <div class="request-card ${getCardClass(req.schStatus)}">
                <div class="card-header">
                    <div>
                        <div class="request-title">${req.schName}</div>
                        <div class="request-meta">
                            <span>신청자: ${req.empName}</span>
                            <span>신청일: ${formatDate(req.schEnrollDate)}</span>
                        </div>
                    </div>
                    <span class="status-badge status-${getStatusClass(req.schStatus)}">
                        ${getStatusText(req.schStatus)}
                    </span>
                </div>
                <div class="card-content">
                    <div class="content-row">
                        <div class="content-item">
                            <span class="content-label">일정 내용</span>
                            <span class="content-value">${req.schContent}</span>
                        </div>
                        <div class="content-item">
                            <span class="content-label">사원번호</span>
                            <span class="content-value">${req.empNo}</span>
                        </div>
                    </div>
                    <div class="content-row">
                        <div class="content-item">
                            <span class="content-label">시작일시</span>
                            <span class="content-value">${formatDate(req.schStartDate)}</span>
                        </div>
                        <div class="content-item">
                            <span class="content-label">종료일시</span>
                            <span class="content-value">${formatDate(req.schEndDate)}</span>
                        </div>
                    </div>
                </div>
                <div class="card-actions">
                    ${req.schStatus === 'c' ? `
                        <button class="btn btn-approve" onclick="updateSchStatus(${req.schNo}, 'approve')">
                            승인
                        </button>
                        <button class="btn btn-reject" onclick="updateSchStatus(${req.schNo}, 'reject')">
                            반려
                        </button>
                    ` : `
                        <button class="btn btn-view" onclick="viewDetails(${req.schNo})">
                            상세보기
                        </button>
                    `}
                </div>
            </div>
        `).join('');
    }
    // 상태 관련 함수
    function getCardClass(status) {
        const classMap = { 'c': 'pending', 'p': 'approved', 'n': 'rejected' };
        return classMap[status];
    }
    function getStatusClass(status) {
        const classMap = { 'c': 'pending', 'p': 'approved', 'n': 'rejected' };
        return classMap[status];
    }
    function getStatusText(status) {
        const textMap = { 'c': '검토', 'p': '승인', 'n': '반려' };
        return textMap[status];
    }
    function formatDate(dateStr) {
        if (!dateStr) return '-';
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${year}년 ${month}월 ${day}일 ${hours}시 ${minutes}분`;
    }
    // 필터 함수
    function filterRequests(filter) {
        currentFilter = filter;
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.classList.add('active');
        renderRequests();
    }
    // 일정 상태 업데이트 및 폼 제출 함수
    function updateSchStatus(schNo, action) {
        const request = confirmSchedules.find(req => req.schNo === schNo);
        const status = action === 'approve' ? 'p' : 'n';
        request.schStatus = status;
        renderRequests();
        const actionText = action === 'approve' ? '승인' : '반려';
        alert(`일정이 ${actionText} 처리되었습니다.`);

        // 폼 제출
        const form = document.getElementById('actionForm');
        document.getElementById('schNo').value = schNo; // schNo 값을 설정
        console.log(schNo);
        form.action = action === 'approve' ? "progress.sd" : "deny.sd";
        form.submit();
    }
    // 상세보기 함수
    function viewDetails(schNo) {
        const request = confirmSchedules.find(req => req.schNo === schNo);
        alert(`일정명: ${request.schName}\n신청자: ${request.empName}\n상태: ${getStatusText(request.schStatus)}`);
    }
    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
        renderRequests();
    });
</script>
</body>
</html>
