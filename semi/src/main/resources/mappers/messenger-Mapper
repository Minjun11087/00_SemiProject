<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="messengerMapper">
    <resultMap type="Messenger" id="messengerResultSet">
        <result column="msg_no" property="msgNo" />
        <result column="emp_sno" property="empSno" />
        <result column="emp_rno" property="empRno" />
        <result column="msg_content" property="msgContent" />
        <result column="msg_date" property="msgDate" />
    </resultMap>

    <resultMap type="Employee" id="employeeResultSet">
        <result column="emp_no" property="empNo" />
        <result column="emp_name" property="empName" />
        <result column="emp_id" property="empId" />
        <result column="emp_pwd" property="empPwd" />
        <result column="emp_gender" property="empGender" />
        <result column="dept_code" property="deptCode" />
        <result column="job_code" property="jobCode" />
        <result column="emp_phone" property="empPhone" />
        <result column="emp_email" property="empEmail" />
        <result column="emp_address" property="empAddress" />
        <result column="emp_status" property="empStatus" />
        <result column="emp_sign" property="empSign" />
        <result column="salary" property="salary" />
        <result column="bonus" property="bonus" />
        <result column="hire_date" property="hireDate" />
        <result column="modify_date" property="modifyDate" />
        <result column="emp_picture" property="empPicture" />
        <result column="messenger_status" property="messengerStatus" />
    </resultMap>

    <select id="selectEmpListMs" resultMap="employeeResultSet">
        select
               emp_no
             , emp_id
             , emp_name
             , messenger_status
          from employee
    </select>

    <update id="updateMsOnline">
        update employee
           set messenger_status = 'Y'
         where emp_id = #{empId}
    </update>

    <update id="updateMsOffline">
            update employee
               set messenger_status = 'N'
             where emp_id = #{empId}
    </update>

    <insert id="sendMessage">
        insert
          into
             ( msg_no
             , emp_sno
             , emp_rno
             , msg_content
             , msg_date
             )
        values
             (
               seq_mno.nextval
             , #{empSno}
             , #{empRno}
             , #{msgContent}
             )
    </insert>

    <select id="selectChatList" resultMap="messageResultSet">
        select
               msg_no
             , emp_sno
             , emp_rno
             , msg_content
             , msg_date
          from message
         where emp_sno = #{empSno}
           and emp_rno = #{empRno}
    </select>

    <select id="selectChatRoom" resultMap="messageResultSet"
        select
               msg_no
             , emp_name
             , msg_content
             , msg_date
          from message
          join employee on (emp_sno = emp_no)
         where emp_rno = #{empRno}
           and emp_sno = #{empSno}
         order
            by msg_date desc
    /select>


</mapper>